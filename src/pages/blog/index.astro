---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const blogPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

function formatDate(d: Date) {
  return d.toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' });
}
---

<Layout title="Blog" description="Writing and notes.">
  <article class="page">
    <header class="page-header">
      <h1 class="page-title">Blog</h1>
      <p class="page-desc">Thoughts and updates.</p>
    </header>

    <ul class="blog-list">
      {blogPosts.map((entry) => (
        <li class="blog-row">
          <span class="blog-date">{formatDate(entry.data.pubDate)}</span>
          <a href={`/blog/${entry.id}`} class="blog-link">{entry.data.title}</a>
        </li>
      ))}
    </ul>
  </article>
</Layout>

<style>
  .page {
    animation: fadeIn 0.5s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .page-header {
    margin-bottom: var(--space-8);
  }

  .page-title {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-weight: 400;
    margin: 0 0 var(--space-2);
    color: var(--color-fg);
  }

  .page-desc {
    font-size: var(--text-base);
    color: var(--color-muted);
    margin: 0;
    line-height: 1.6;
  }

  .blog-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .blog-row {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: var(--space-2);
    margin-bottom: var(--space-2);
  }

  .blog-date {
    color: var(--color-muted);
    font-size: var(--text-sm);
    flex-shrink: 0;
  }

  .blog-link {
    color: var(--color-accent);
  }
</style>
